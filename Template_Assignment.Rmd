---
title: "Programming for economists project - excessive alcohol use in The Netherlands"
author: "Derek van der Linden (2860655), Tom Haandrikman (2866711), Anouk Knaack (2772444), Sara Hoogenboom (2825231), Levi van der Kolk (...), Isabel Nagel (2812985)"
date: "24-6-2025"
output: pdf_document
---

# Set-up your environment

```{r package_install, include=FALSE}
#install.packages("tidyverse")
```

```{r packages}
require(tidyverse)
library(readr)
```

# Excessive alcohol use in The Netherlands

Derek van der Linden (2860655), Tom Haandrikman (2866711), Anouk Knaack (2772444), Sara Hoogenboom (2825231), Levi van der Kolk (...), Isabel Nagel (2812985)

CPR02 - Chantal Schouwenaar,

# Part 1 - Identify a Social Problem

1.1 Describe the Social Problem

Our project is about the use of excessive alcohol in Rotterdam and a smaller town close to it called Krimpenerwaard. We are going to combine this with the distance to facilities to buy alcohol, such as cafes, nightclubs, coffee shops and other party center. We are going to compare the two places with different years: 2016, 2020 and 2022. Also, we made a graph showing the overall unhealthiness combining different variables and comparing them with the different

Excessive drinking is a big societal problem and causes different issues, as well as health consequences, legal and social consequences. The excessive abuse of alcohol can affect your breathing, heart rate and gag reflex and also potentially lead to coma and death. It can also contribute to criminal behavior and many other social consequences, such as: financial problems due to excessive spending on alcohol, impacts on work performance and the loss of friends and family (SA Health, n.d.). 

Of course, there has been much research into excessive alcohol use, but no research that aligns with that of ours; comparing a big city to a smaller town combined with the distance to facilities. In Rotterdam there is a higher accessibility of facilities than in Krimpenerwaard. Our research could provide us with insights into whether this difference influences people’s alcohol use. Also, the different years could show insights into if the covid-19 pandemic has had any influence on the use of excessive alcohol.

# Part 2 - Data Sourcing

## 2.1 Load in the data

```{r loading_data}
Alcohol_data_2016<- read_csv("data/Data/Gezondheid_per_wijk_en_buurt__2022_18062025_140754.csv")

Alcohol_data_2020<- read_csv("data/Data/Gezondheid_per_wijk_en_buurt__2022_18062025_140356.csv")

Alcohol_data_2022<- read_csv("data/Data/Gezondheid_per_wijk_en_buurt__2022_18062025_140404.csv")

Nabijheid_voorzieningen2016 <- read_csv("nabijheid_voorzieningen2016.csv")

Nabijheid_voorzieningen2020 <- read_csv("nabijheid_voorzieningen2020.csv")

Nabijheid_voorzieningen2022 <- read_csv("nabijheid_voorzieningen2022.csv")


```

## 2.2 Provide a short summary of the dataset(s) (Levi)

```{r}
#head(dataset)
```

In this case we see 28 variables, but we miss some information on what units they are in. We also don't know anything about the year/moment in which this data has been captured.

``` r
inline_code = TRUE
```

These are things that are usually included in the metadata of the dataset. For your project, you need to provide us with the information from your metadata that we need to understand your dataset of choice.

## 2.3 Describe the type of variables included (Levi)

Think of things like:

-   Do the variables contain health information or SES information?

-   Have they been measured by interviewing individuals or is the data coming from administrative sources?

*For the sake of this example, I will continue with the assignment...*

# Part 3 - Quantifying

## 3.1 Data cleaning

```{r data_cleaning}
library(dplyr)
library(readr)

setwd("~/Documents/GitHub/School_Opdracht")
nabijheid_voorzieningen2016 <- read_csv("nabijheid_voorzieningen2016.csv")
nabijheid_voorzieningen2020 <- read_csv("nabijheid_voorzieningen2020.csv")
nabijheid_voorzieningen2022 <- read_csv("nabijheid_voorzieningen2022.csv")
merged_data <- nabijheid_voorzieningen2016 %>%
  full_join(nabijheid_voorzieningen2020, by = "Regioaanduiding.Codering..code.", suffix = c("_2016", "_2020")) %>%
  full_join(nabijheid_voorzieningen2022, by = "Regioaanduiding.Codering..code.")
nabijheid_voorzieningen2016$...1 <- NULL
voorzien <- rbind(nabijheid_voorzieningen2016, nabijheid_voorzieningen2020,nabijheid_voorzieningen2022)
write_csv(voorzien,"data/Data/voorzieningen.csv")
merged_data <- voorzien %>%
  merge(AlcoholBuurten, by = "Regioaanduiding.Codering..code.")

AlcoholBuurten <- read_csv("data/AlcoholBuurten.csv")
nabijheid_voorzieningen2016$Perioden <- 2016
nabijheid_voorzieningen2020$Perioden <- 2020
nabijheid_voorzieningen2022$Perioden <- 2022

nabijheid_voorzieningen2016$...1 <- NULL

voorzien <- rbind(nabijheid_voorzieningen2016, nabijheid_voorzieningen2020,nabijheid_voorzieningen2022)
write_csv(voorzien,"data/Data/voorzieningen.csv")
merged_data <- voorzien %>%
  merge(AlcoholBuurten, by = c("Regioaanduiding.Codering..code.", "Perioden"))
write_csv(merged_data,"data/Data/merged_data.csv")

```

## 3.2 Generate necessary variables (Isabel)

**Variable 1:**\
First we created the new variable Distance_cafes, we created this one to classify whether the distance to facilities as cafes, nightclubs, coffee shops and other party centers are located closer or further than 1 kilometer averagely for people from Rotterdam and Krimpenerwaard. We introduced this categorization (“Cafes closer than 1 km” vs. “Cafes further than 1km”) to make it easier to analyze whether proximity to facilities is associated with patterns of excessive alcohol use. By simplifying this distance measure, we can more clearly examine potential relationships between access to drinking venues and alcohol consumption behavior.

```{merged_data <- merged_data %>%}
  mutate(Distance_cafes = if_else(
    Horeca.Cafés.en.dergelijke.Afstand.tot.café.e.d...km.> 1,
    "Cafes further than 1 km",
    "Cafes closer than 1 km"
  ))

```

**Variable 2:**\
The second variable Unhealthiness score represents the average level of several key health risk factors within a given population. We calculated this as the mean of the following six indicators, all looking at both Rotterdam & Krimpenerwaard:\
- Percentage of smokers\
- Percentage of heavy drinkers\
- Percentage of excessive drinkers\
- Percentage reporting one or more chronic physical conditions\
- Percentage at high risk of anxiety or depression\
- Percentage experiencing serious or very serious loneliness

By combining these indicators into a single score, we get a general measure of overall unhealthiness, making it way easier to compare regions. It also makes it easier to see how the health changed through the years in both places.

```{r gen_var2}
library(dplyr)

# Select columns to include in the score
cols_to_convert <- c(
  "Roker....",
  "Alcoholgebruik.Zware.drinker....",
  "Alcoholgebruik.Overmatige.drinker....",
  "Lichamelijke.gezondheid.Eén.of.meer.langdurige.aandoeningen....",
  "Hoog.risico.op.angst.of.depressie....",
  "Eenzaamheid.Ernstig.zeer.ernstig.eenzaam...."
)

# Replace commas with periods and convert character values to numeric
merged_data[cols_to_convert] <- lapply(merged_data[cols_to_convert], function(x) {
  x <- gsub(",", ".", x)
  as.numeric(x)
})

# Calculate the unhealthiness_score as the average of the selected columns
merged_data <- merged_data %>%
  mutate(
    ongezondheid_score = rowMeans(select(., all_of(cols_to_convert)), na.rm = TRUE)
  )


```

## 3.3 Visualize temporal variation

This line graph titled “Average Unhealthiness Score: Rotterdam vs Krimpenerwaard” uses our second new variable we’ve created. It compares the average unhealthiness scores of two places Rotterdam and Krimpeneraard, over three years: 2016, 2020 and 2022. This shows us very easily if the type of place, more urban like Rotterdam, or more rural and small-town like Krimpenerwaard, has any influence on the healthiness of the people that live there. In the discussions we will go further in the observations from this graph.

```{r}
# Gemiddelde ongezondheid_score per jaar berekenen
library(dplyr)
library(ggplot2)

# Calculate average unhealthiness score per year and plot
# Make sure the column with city name is correctly named

merged_data %>%
  filter(Regioaanduiding.Gemeentenaam..naam..x %in% c("Rotterdam", "Krimpenerwaard")) %>%
  group_by(Perioden, Regioaanduiding.Gemeentenaam..naam..x) %>%
  summarise(avg_unhealthiness = mean(ongezondheid_score, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = Perioden, y = avg_unhealthiness, color = Regioaanduiding.Gemeentenaam..naam..x)) +
  geom_line() +
  scale_y_continuous(breaks = seq(11,19, by = 0.5), limits =c(11,18.5)) +
  geom_point() +
  labs(
    title = "Average Unhealthiness Score: Rotterdam vs Krimpenerwaard",
    x = "Year",
    y = "Unhealthiness Score",
    color = "Place"
  ) +
  theme_minimal()
```

## 3.4 Visualize spatial variation

This map “Neighborhoods in Rotterdam & Krimpenerwaard (2024) is based on their proximity to facilities to buy alcohol, such as cafes, nightclubs, coffee shops and other party centers. It uses the first new variable we created: Distance_cafes.

-   The Red (Cafes closer than 1 km) parts show us the part where the neighborhoods have a cafe or similar venue within 1 kilometer.

-   The blue/teal (Cafes further than 1 km) parts show where the neighborhoods are that are more than 1 kilometer away from the nearest cafe or similar venue.

-   Then we have the grey (NA) parts that have no data available for these neighborhoods.

This map helps us to identify areas where people are more likely to have easy access to drinking venues, which could contribute to higher alcohol consumption.

\* On some of our laptops the code of the graph runned totally fine and on some it didn’t work. If the code doesn’t load, please let us know.

```{r visualise_map}
setwd("~/Documents/GitHub/School_Opdracht")

if (!require("remotes")) install.packages("remotes")
if (!require("sf")) install.packages("sf")
if (!require("tidyverse")) install.packages("tidyverse")
if (!require("cbsodataR")) install.packages("cbsodataR")
  
library(tidyverse)
library(sf)
library(cbsodataR)
library(ggplot2)
maps<- cbs_get_maps()
prov_sf <- cbs_get_sf(region = "provincie", year = 2022)

ggplot2::ggplot(prov_sf) +
  geom_sf()
  
merged_data <- read_csv("data/Data/merged_data.csv")
maps <- cbs_get_maps()
prov_map_yr <- max(maps$year[maps$region == "provincie"])

prov_sf <- cbs_get_sf(region = "provincie", year = prov_map_yr)

zh_sf <- prov_sf %>% filter(statnaam == "Zuid-Holland")

ggplot(zh_sf) +
  geom_sf(fill = "#2b8cbe", colour = "white") +
  theme_void() +
  labs(title = paste0("Provincie Zuid-Holland – CBS kaart ", prov_map_yr))

muni_sf <- cbs_get_sf("provincie", prov_map_yr)

#wijken en buurten er over heen
prov_map_yr <- max(cbs_get_maps()$year[cbs_get_maps()$region == "provincie"])
zh_sf <- cbs_get_sf("provincie", prov_map_yr) %>%
  filter(statnaam == "Zuid-Holland")

wijk_map_yr <- max(cbs_get_maps()$year[cbs_get_maps()$region == "wijk"])
wijken_sf <- cbs_get_sf("wijk", wijk_map_yr)


merged_data <- merged_data %>%
  mutate(Distance_cafes = if_else(
    Horeca.Cafés.en.dergelijke.Afstand.tot.café.e.d...km.> 1,
    "Cafes further than 1 km",
    "Cafes closer than 1 km"
  ))

#write.csv(merged_data, "data/Data/merged_data.csv")

#multipolygon koppelen aan merged_goeie (die wijkcodes)
wijken_sf<-sf::st_as_sf(wijken_sf)
merged_2016 <- merged_data %>%
  filter(Perioden == 2016)

merged_2016<- as.data.frame(merged_2016)

#merged_2016$geometry <- NULL

wijken_sf <- wijken_sf %>%
  rename("Regioaanduiding.Codering..code." = "statcode")

merged_2016 <- merged_2016 %>% merge(wijken_sf, 
                                     by = "Regioaanduiding.Codering..code.")



##### Poging 3 ------
library(cbsodataR)
library(ggplot2)
library(dplyr)
library(sf)
library(stringr)

# 1. Most-recent vintages
maps      <- cbs_get_maps()
prov_year <- max(maps$year[maps$region == "provincie"])
wijk_year <- max(maps$year[maps$region == "wijk"])

# 2. Read layers (will return data.frames if Tibble Hunter is on)
zh_sf_raw     <- cbs_get_sf("provincie", prov_year) |>
  filter(statnaam == "Zuid-Holland")

wijken_sf_raw <- cbs_get_sf("wijk", wijk_year)

# 3. Keep neighbourhoods in Rotterdam & Krimpenerwaard
gem_codes <- c("0599", "1931")                      # GM-codes → digits
wijken_subset_raw <- wijken_sf_raw |>
  mutate(gem_code = str_extract(statcode, "\\d{4}")) |>
  filter(gem_code %in% gem_codes)

# 4. Convert back to sf **here**
zh_sf        <- st_as_sf(zh_sf_raw)
wijken_subset <- st_as_sf(wijken_subset_raw)

# 5. Plot

merged_2016 <- st_as_sf(merged_2016)

ggplot() +
  geom_sf(data = merged_2016,
          aes(fill = Distance_cafes), colour = "white", linewidth = .15) +
  theme_minimal() +
  labs(title = sprintf("Neighbourhoods in Rotterdam & Krimpenerwaard (%s)", wijk_year),
       fill  = "Neighbourhood") +
  guides(fill = guide_legend(override.aes = list(colour = "black")))


```

## 3.5 Visualize sub-population variation

What is the average obesity rate from the different neighbourhoods in Krimpenerwaard and Rotterdam. This plotted in a box plot against the percentage of excessive alcohol use.

\* On some of our laptops the code of the graphs runned totally fine and on some it didn’t work. If the code doesn’t load, please let us know.

```{r visualise_subpopulations}
library(tidyverse)

#omzetten naar numeric + calculating average obesity rate
mean(as.numeric(merged_2016$Onder..en.overgewicht.Mate.van.overgewicht.Ernstig.overgewicht....), na.rm = TRUE) #15.56333

#subgroup
merged_2016 = mutate(merged_2016, Obesity_rate = ifelse(Onder..en.overgewicht.Mate.van.overgewicht.Ernstig.overgewicht.... >=15.56333,
                                                   "Above_average", "Below_average"))

write.csv(merged_2016, "Data/data/merged_2016.csv")
merged_2016$Alcoholgebruik.Overmatige.drinker.... <- merged_2016$Alcoholgebruik.Overmatige.drinker.... %>% as.numeric()

#plotten
ggplot(merged_2016, aes(x=Obesity_rate, y=Alcoholgebruik.Overmatige.drinker....))+
  geom_boxplot() +
  labs(x="Obesity rate", y="Percentage of excessive alcohol use", title = "Alcohol vs obesity rate 2016")
```

## 3.6 Event analysis

Analyze the relationship between two variables.

```{r analysis}
library(dplyr)
library(ggplot2)

wijken_data <- merged_data %>%
  filter(Regioaanduiding.Soort.regio..omschrijving..x == "Wijk")
wijken_data <- wijken_data %>%
  filter(Alcoholgebruik.Overmatige.drinker.... != ".")


wijken_data$Alcoholgebruik.Overmatige.drinker.... <-
  as.numeric(gsub(",", ".", wijken_data$Alcoholgebruik.Overmatige.drinker....))

  
  library(ggplot2)
  
ggplot(wijken_data, aes(
    x = Perioden,
    y = Alcoholgebruik.Overmatige.drinker....,
    group = Wijken.en.buurten.x,
    color = Wijken.en.buurten.x
  )) +
    geom_line() +
  geom_vline(xintercept = 2020) +
  annotate("text", x =2019, y=8.5,size = 5, label="COVID-19\nCrisis") +
    geom_point(size = 1.5) +
    scale_y_continuous(breaks = seq(4, 9, 0.5), limits = c(4, 9)) +
    labs(
      title = "Excessive alcohol consumption per neighborhood over time",
      x = "Year",
      y = "% Excessive drinkers",
      color = "Neighborhood"
    ) +
    theme_minimal(base_size = 14) +
    theme(
      legend.text = element_text(size = 6),
      legend.title = element_text(size = 8),
      legend.key.size = unit(0.4, "cm"),
      plot.title = element_text(size = 16, face = "bold"),
      axis.text = element_text(size = 12)
    )

```

# Part 4 - Discussion

## 4.1 Discuss your findings

We will now discuss the findings per graph we made, since they are all so different from each other. Then, we will combine these findings to find a conclusion corresponding to all graphs.

**3.3 visualize temporal variation**\
The key observation from this graph is that Rotterdam consistently has a higher healthiness score than Krimpenerwaard in all years. Also, it is very clear that from both places the unhealthiness scores dropped in 2020. This could indicate a connection with the covid-19 crisis and the isolation that people were in, which made them live healthier. Both places are showing a U-shaped trend, meaning that unhealthiness decreased from 2016 to 2020 and then increased again by 2022. However, the gap between the both of them remains consistent, with Rotterdam showing higher levels of the unhealthiness score across all those time points. This could suggest that factors related to urban environments (as in Rotterdam) are associated with higher health risk indicators as in the unhealthiness score such as: smoking, heavy drinking, chronic illness, mental health issues and loneliness.

**3.4 visualize spatial variation**\
In Rotterdam, which is on the left side of the map, you can see that most of the neighborhoods are colored red, meaning cafés are generally very accessible. That fits with what we’d expect in a large, urban city like Rotterdam. Comparing this to Krimpenerwaard, on the right side of the map, there are more blue areas. This means there is more rural character and thus a greater distance to cafés. This difference between areas supports further analysis on how the distance to cafés might relate to excessive alcohol use, as previously discussed.

# Part 5 - Reproducibility

## 5.1 Github repository link

Provide the link to your PUBLIC repository here: <https://github.com/Tombo14/School_Opdracht>

## 5.2 Reference list

Use APA referencing throughout your document.
